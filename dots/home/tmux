##### Basics #####
set -g mouse on
set -g history-limit 100000
set -g default-terminal "tmux-256color"
# Truecolor + OSC 52 (clipboard) capability for common terms
set -ga terminal-overrides ',xterm-256color:Tc:Ms=\E]52;c;%p2%s\007,tmux-256color:Tc:Ms=\E]52;c;%p2%s\007'
# Enable OSC 52 copy (tmux â‰¥ 3.2)
set -s set-clipboard on

##### Pane navigation + splits (current dir) #####
bind -r h select-pane -L
bind -r j select-pane -D
bind -r k select-pane -U
bind -r l select-pane -R

bind -n C-h select-pane -L
bind -n C-j select-pane -D
bind -n C-k select-pane -U
bind -n C-l select-pane -R

set -g prefix C-a
unbind C-b
bind C-a send-prefix

bind '"' split-window -v -c "#{pane_current_path}"
bind %  split-window -h -c "#{pane_current_path}"

bind r  source-file ~/.tmux.conf \; display "tmux reloaded"

##### Vi-style copy mode + universal clipboard #####
setw -g mode-keys vi

# Detect best clipboard tool. If none, leave empty to use OSC 52 path.
run-shell '
if command -v pbcopy >/dev/null 2>&1; then
  tmux set -g @copycmd "pbcopy"
elif command -v wl-copy >/dev/null 2>&1; then
  tmux set -g @copycmd "wl-copy"
elif command -v xclip >/dev/null 2>&1; then
  tmux set -g @copycmd "xclip -selection clipboard"
else
  tmux set -g @copycmd ""
fi
'

# Helper: if we have a copycmd, pipe; else use OSC 52 via copy-selection-and-cancel
bind -T copy-mode-vi y      if -F '#{!=:#{@copycmd},}' 'send -X copy-pipe-and-cancel "#{@copycmd}"' 'send -X copy-selection-and-cancel'
bind -T copy-mode-vi Enter  if -F '#{!=:#{@copycmd},}' 'send -X copy-pipe-and-cancel "#{@copycmd}"' 'send -X copy-selection-and-cancel'
bind -T copy-mode     y      if -F '#{!=:#{@copycmd},}' 'send -X copy-pipe-and-cancel "#{@copycmd}"' 'send -X copy-selection-and-cancel'
bind -T copy-mode     Enter  if -F '#{!=:#{@copycmd},}' 'send -X copy-pipe-and-cancel "#{@copycmd}"' 'send -X copy-selection-and-cancel'

# Mouse: drag to select, copy on release (works in both vi/emacs tables)
bind -T copy-mode-vi MouseDragEnd1Pane if -F '#{!=:#{@copycmd},}' 'send -X copy-pipe-and-cancel "#{@copycmd}"' 'send -X copy-selection-and-cancel'
bind -T copy-mode    MouseDragEnd1Pane if -F '#{!=:#{@copycmd},}' 'send -X copy-pipe-and-cancel "#{@copycmd}"' 'send -X copy-selection-and-cancel'

# Optional: smoother wheel behavior
bind -n WheelUpPane   if -F '#{pane_in_mode}' { send -X -M scroll-up } { copy-mode -e }
bind -n WheelDownPane if -F '#{pane_in_mode}' { send -X -M scroll-down } { send -X cancel }

##### Quality-of-life #####
set -g escape-time 0
set -g renumber-windows on
set -g base-index 1
setw -g pane-base-index 1
set -g bell-action none

##### Extras #####
bind S setw synchronize-panes \; display "sync-panes: #{?pane_synchronized,on,off}"
bind -r H resize-pane -L 5
bind -r J resize-pane -D 2
bind -r K resize-pane -U 2
bind -r L resize-pane -R 5
bind m set -g mouse \; display "tmux: mouse #{?mouse,on,off}"