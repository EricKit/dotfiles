##### Basics #####
set -g mouse on                       # enable mouse support (pane resize, selection, scroll)
set -g history-limit 100000           # large scrollback buffer
set -g default-terminal "tmux-256color"
set -ga terminal-overrides ",xterm-256color:Tc,tmux-256color:Tc"  # truecolor override

##### Pane navigation + splits (current dir) #####
# Vim-style movement with prefix
bind -r h select-pane -L
bind -r j select-pane -D
bind -r k select-pane -U
bind -r l select-pane -R

# Also allow Ctrl-h/j/k/l without prefix
bind -n C-h select-pane -L
bind -n C-j select-pane -D
bind -n C-k select-pane -U
bind -n C-l select-pane -R

# Split panes, stay in current working directory
bind '"' split-window -v -c "#{pane_current_path}"
bind %  split-window -h -c "#{pane_current_path}"

# Reload config
bind r  source-file ~/.tmux.conf \; display "tmux reloaded"

##### Vi-style copy mode + clipboard integration #####
setw -g mode-keys vi

# Auto-detect system clipboard command (macOS pbcopy / Linux wl-copy or xclip)
run-shell '
if command -v pbcopy >/dev/null 2>&1; then
  tmux set -g @copycmd "pbcopy"
elif command -v wl-copy >/dev/null 2>&1; then
  tmux set -g @copycmd "wl-copy"
elif command -v xclip >/dev/null 2>&1; then
  tmux set -g @copycmd "xclip -selection clipboard"
else
  tmux set -g @copycmd "cat >/dev/null"   # harmless fallback
fi
'

# Copy with keys while in copy-mode (vi)
bind -T copy-mode-vi v      send -X begin-selection
bind -T copy-mode-vi y      send -X copy-pipe-and-cancel "#{@copycmd}"
bind -T copy-mode-vi Enter  send -X copy-pipe-and-cancel "#{@copycmd}"

# *** Fix: mouse drag to copy on release ***
bind -T copy-mode-vi MouseDragEnd1Pane send -X copy-pipe-and-cancel "#{@copycmd}"

# Smooth scroll into copy-mode with wheel (optional QoL)
bind -n WheelUpPane if -F '#{pane_in_mode}' { send -X -M scroll-up } { copy-mode -e }
bind -n WheelDownPane if -F '#{pane_in_mode}' { send -X -M scroll-down } { send -X cancel }

# Enable OSC 52 clipboard if supported (tmux â‰¥3.2)
set -s set-clipboard on

##### Quality-of-life #####
set -g escape-time 0
set -g renumber-windows on
set -g base-index 1
setw -g pane-base-index 1
set -g bell-action none

##### Extras #####
# Synchronize panes toggle
bind S setw synchronize-panes \; display "sync-panes: #{?pane_synchronized,on,off}"

# Resize panes with Vim-like keys (holdable)
bind -r H resize-pane -L 5
bind -r J resize-pane -D 2
bind -r K resize-pane -U 2
bind -r L resize-pane -R 5

# Quick mouse toggle if you ever want native terminal selection
bind m set -g mouse \; display "tmux: mouse #{?mouse,on,off}"